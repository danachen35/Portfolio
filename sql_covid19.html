<!DOCTYPE HTML>
<!--
	Future Imperfect by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Covid19 Project</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="future-assets/css/main.css" />

		<!-- This is where Prism.js and other styles/scripts go -->
		<link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css" rel="stylesheet" />
		<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-sql.min.js"></script>
		<link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
		<!-- add custom styles (like font, size, padding) for your Prism code blocks -->
			<style>
				/* Customize code block background, font, spacing */
				pre[class*="language-"] {
				  max-width: 90%;		/* or 100%, or any px/em value */
				  margin: 0 auto;		/* center it */
				  background: #f9f9f9;
				  padding: 1em;
				  border-radius: 6px;
				  font-size: 0.8em;
				  font-family: 'Fira Code', Consolas, Monaco, monospace;
				  line-height: 1.5;
				  overflow-x: auto;
				  margin-top: =2em;
				  margin-bottom: 2em;
				}

				/* Optional: change text color inside the code */
				code[class*="language-"] {
				  color: #333;
				  display: block;
				  text-align: left;
				  padding: 1em; /* This indents the code inside the block */
				}
			</style>
	</head>
	<body class="single is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<h1><a href="index.html">Dana Chen | Business Analyst Portfolio</a></h1>
						<nav class="links">
							<!-- <ul>
								<li><a href="#">Lorem</a></li>
								<li><a href="#">Ipsum</a></li>
								<li><a href="#">Feugiat</a></li>
								<li><a href="#">Tempus</a></li>
								<li><a href="#">Adipiscing</a></li>
							</ul> -->
						</nav>
						<nav class="main">
							<ul>
								<li class="search">
									<a class="fa-search" href="#search">Search</a>
									<form id="search" method="get" action="#">
										<input type="text" name="query" placeholder="Search" />
									</form>
								</li>
								<li class="menu">
									<a class="fa-bars" href="#menu">Menu</a>
								</li>
							</ul>
						</nav>
					</header>

				<!-- Menu -->
					<section id="menu">

						<!-- Search -->
							<section>
								<form class="search" method="get" action="#">
									<input type="text" name="query" placeholder="Search" />
								</form>
							</section>

						<!-- Links -->
							<section>
								<ul class="links">
									<li>
										<a href="#">
											<h3>Lorem ipsum</h3>
											<p>Feugiat tempus veroeros dolor</p>
										</a>
									</li>
									<li>
										<a href="#">
											<h3>Dolor sit amet</h3>
											<p>Sed vitae justo condimentum</p>
										</a>
									</li>
									<li>
										<a href="#">
											<h3>Feugiat veroeros</h3>
											<p>Phasellus sed ultricies mi congue</p>
										</a>
									</li>
									<li>
										<a href="#">
											<h3>Etiam sed consequat</h3>
											<p>Porta lectus amet ultricies</p>
										</a>
									</li>
								</ul>
							</section>

						<!-- Actions -->
							<section>
								<ul class="actions stacked">
									<li><a href="#" class="button large fit">Log In</a></li>
								</ul>
							</section>

					</section>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<article class="post">
								<header>
									<div class="title">
										<h2><a href="#"></a>SQL-Based Analysis of Hospital Capacity & Utilization</h2>
										<!-- When Capacity Runs Thin: Public Health Insights from 1M Hospital Records -->
										<!-- What 1M U.S. Hospital Records Reveal About COVID Strain -->
										<p>SQL | Database | Excel | Tableau | Storytelling</p>
									</div>
									<div class="meta">
										<time class="published" datetime="2015-11-01">August 1, 2024</time>
										<a href="#" class="author"><span class="name">Dana Chen</span><img src="images/headshot2.jpg" alt="" /></a>
									</div>
								</header>
								<span class="image featured"><img src="images/covid_cover.png" alt="" /></span>
								<p></p>
								<br />

					
								<p><h2 style="margin-bottom: 0.5em;">Analyzing U.S. COVID-19 Hospitalization Trends & Bed Capacity with SQL</h2>
								In this project, I analyzed nearly 1 million records of hospital-reported COVID-19 data from 2020 to 2024 to assess how the pandemic impacted healthcare capacity across the U.S. Using MySQL and public datasets, this analysis explores how COVID-related hospitalizations evolved across time and geography, while assessing whether hospital resources were effectively utilized or strained. It also identifies which regions, states may require greater attention and preparedness for future health crises.
								</p>


								<p><h4 style="margin-bottom: 0.5em;">Dataset Overview & Preparation</h4>
								To ensure clean and analyzable data from the original 964,000+ weekly hospital records spanning 2020 to 2024, we performed several key preprocessing steps. Given the large number of columns (128 fields), I narrowed our focus to the most relevant metrics, including total inpatient beds, COVID-related bed usage, confirmed weekly hospitalizations, and renamed long column headers for MySQL compatibility. I also removed duplicate entries and used STR_TO_DATE() to standardize date formats, extracting consistent month and year components to support accurate time-series analysis.
								<br>
								To enhance the depth of analysis, the dataset was further enriched by joining two contextual layers:
								<ul style="margin-bottom: 0;">
								<li>Region mapping based on U.S. Census Bureau definitions to enable regional comparisons
								<li>U.S. Census population estimates (2020–2023) to allow for population-adjusted metrics
								</li>
								</ul>
								<span class="image featured"><img src="images/covid_datamapping.png" alt="" style="width: 400px; height: auto; vertical-align: top; margin-left: 15px;" /></span>
								<!-- This preparation process laid the foundation for faster querying, more meaningful insights, and consistency throughout the downstream analysis and visualizations. -->

								<p><h4 style="margin-bottom: 0.5em;">Understanding System Readiness: Hospital Capacity by State</h4>
								Before evaluating how the COVID-19 pandemic stressed the U.S. healthcare system, I first quantified the core capacity of hospitals across the country. Using a cleaned dataset of nearly 1 million records, I calculated the average number of total beds, inpatient beds, and COVID-related inpatient usage per hospital, then aggregated those values by state to reflect the typical resource availability throughout the pandemic period. <br>
								This baseline snapshot of bed capacity helped set the stage for deeper comparisons against actual hospitalization trends and system utilization over time.
								<br>
								<span style="font-size: 0.85em;">Note on Aggregation Approach:
								To avoid skew from hospitals that reported data more frequently or inconsistently, I first calculated the average number of beds reported per hospital across the full dataset. Then, I summed these per-hospital averages by state. This “SUM of AVG” method ensures that each hospital is equally represented in the state totals, rather than over-weighting hospitals with more rows. </span>
								

								<pre><code class="language-sql">
			-- Hospital capacity: total beds, inpatient beds, COVID bed usage (per state), hospital counts
			WITH hospital_beds AS (
					SELECT 
						r.hospital_pk,
						r.state,
						AVG(CASE WHEN tot_beds_7daysum IS NOT NULL AND tot_beds_7daysum > 0 THEN tot_beds_7daysum ELSE NULL END) AS AvgTotBeds,
			        	AVG(CASE WHEN inpat_beds_7daysum IS NOT NULL AND inpat_beds_7daysum > 0 THEN inpat_beds_7daysum ELSE NULL END) AS AvgInpatBeds,
			        	AVG(CASE WHEN inpat_beds_used_covid_7daysum IS NOT NULL AND inpat_beds_used_covid_7daysum > 0 THEN inpat_beds_used_covid_7daysum ELSE NULL END) AS AvgCovidBeds
			        FROM tmp_raw_data_3 r
			        INNER JOIN region_mapping m ON r.state = m.statecode
			        GROUP BY r.hospital_pk, r.state),
				 hospital_counts AS (
				 	SELECT 
			        	r.state,
			        	COUNT(DISTINCT r.hospital_pk) AS hospital_cnt_map
			    	FROM tmp_raw_data_3 r
			    	INNER JOIN region_mapping m ON r.state = m.statecode
			    	GROUP BY r.state)
			SELECT
			    hb.state,
			    hc.hospital_cnt_map AS hospital_count,
			    SUM(hb.AvgTotBeds) AS state_TotalBeds,
			    SUM(hb.AvgInpatBeds) AS state_InpatBeds,
			    SUM(hb.AvgCovidBeds) AS state_CovidBeds
			FROM hospital_beds AS hb
			INNER JOIN hospital_counts AS hc ON hb.state = hc.state
			GROUP BY hb.state, hc.hospital_cnt_map;
								</code></pre>
								<span class="image featured"><img src="images/covid_map1.png" alt="" /></span>
								<span class="image featured"><img src="images/covid_map2.png" alt="" /></span>
								</p>
								<br />

								<p><h4 style="margin-bottom: 0.5em;">Where the Pressure Hit Hardest: Regional Hospitalization Trends</h4>
								With hospital capacity established, I next analyzed how COVID-19-related hospitalizations varied across U.S. regions and states. By cleaning and standardizing hospitalization data using STR_TO_DATE() and handling outliers (e.g., replacing -999999 with 0), I then joined the data with U.S. Census region mappings to enable aggregated reporting. Using (MAX(CASE WHEN...)) structure and aggregating confirmed adult and pediatric COVID hospitalizations from August 2020 to April 2024, I was able to find key patterns through regional trend comparisons.
								<br>
								
								<!-- With hospital capacity established, I next analyzed how COVID-19-related hospitalizations were distributed across U.S. regions and states. By aggregating weekly reported hospital admissions for confirmed adult and pediatric COVID cases, I uncovered which areas faced the greatest burden and how those patterns evolved throughout the pandemic. -->
								<!-- <br> -->
								<!-- The South emerged as the most severely affected region, accounting for over 40% of national COVID-19 hospitalizations — largely driven by Texas and Florida. The Midwest followed closely, with Illinois and Ohio contributing the highest volumes. These insights helped illustrate the uneven geographic toll of the crisis. -->
								<!-- <p><h2 style="margin-bottom: 0.5em;">Insight #1: South Was the Most Affected Region</h2>
								I cleaned and prepared the data using STR_TO_DATE() to extract month and year, and used CASE WHEN to handle outliers like -999999. After joining with a region mapping table, I grouped hospitalizations by region and time using SUM() and GROUP BY. To compare regions side by side, I used MAX(CASE WHEN...) to pivot totals into columns for visualization. -->

								<pre><code class="language-sql">
				-- Regional aggregation of hospitalizations
				SELECT month,
				       Max(CASE WHEN region = 'West' THEN adultcovid ELSE NULL END) + 
				       Max(CASE WHEN region = 'West' THEN pedcovid ELSE NULL END)      AS West,
				       Max(CASE WHEN region = 'Midwest' THEN adultcovid ELSE NULL END) + 
				       Max(CASE WHEN region = 'Midwest' THEN pedcovid ELSE NULL END)   AS Midwest,
				       Max(CASE WHEN region = 'Northeast' THEN adultcovid ELSE NULL END) + 
				       Max(CASE WHEN region = 'Northeast' THEN pedcovid ELSE NULL END) AS Northeast,
				       Max(CASE WHEN region = 'South' THEN adultcovid ELSE NULL END) + 
				       Max(CASE WHEN region = 'South' THEN pedcovid ELSE NULL END)     AS South
				FROM  (SELECT Concat(Monthname(clc_wk), '-', Year(clc_wk)) AS Month,
				              m.region,
				              Sum(CASE WHEN adult = -999999 THEN 0 ELSE adult END)     AS AdultCOVID,
				              Sum(CASE WHEN ped = -999999 THEN 0 ELSE ped END)         AS PedCOVID
				       FROM  ( (SELECT Str_to_date(collection_week, '%Y-%m-%d')        AS clc_wk,
				                       state,
				                       tot_adult_patients_hosp_confrm_covid_7daysum    AS adult,
				                       tot_ped_patients_hosp_confrm_covid_7daysum      AS ped
				                FROM   tmp_raw_data_3) AS r
				                INNER JOIN (SELECT statecode, state, region
				                            FROM   region_mapping) AS m ON r.state = m.statecode )
				        GROUP  BY 1, 2) AS sub
				GROUP  BY 1; 
								</code></pre>

								<pre><code class="language-sql">
				-- State-wise aggregation of hospitalizations
				SELECT Concat(Monthname(clc_wk), '-', Year(clc_wk)) AS Month,
				       r.state                                      AS StateCode,
				       r.state,
				       m.region,
				       Sum(CASE WHEN adult = -999999 THEN 0 ELSE adult END) AS AdultCOVID,
				       Sum(CASE WHEN ped = -999999 THEN 0 ELSE ped END)     AS PedCOVID
				FROM  ( (SELECT Str_to_date(collection_week, '%Y-%m-%d')       AS clc_wk,
				                state,
				                tot_adult_patients_hosp_confrm_covid_7daysum   AS adult,
				                tot_ped_patients_hosp_confrm_covid_7daysum     AS ped
				         FROM   tmp_raw_data_3) AS r
				         INNER JOIN (SELECT statecode, state, region
				                     FROM   region_mapping) AS m ON r.state = m.statecode )
				GROUP  BY 1, 2, 3, 4;
								</code></pre>
						
								The South emerged as the hardest-hit region, contributing 41% of total COVID hospitalizations nationwide — nearly double the share of other regions. Two states, Texas (22%) and Florida (21%), together accounted for over 43% of the South’s hospitalization load. In the Midwest, hospitalizations were more evenly distributed, but still heavily driven by Illinois (18%) and Ohio (17%), which together made up more than a third of the region’s volume. This highlights a few states still experienced disproportionately high strain even in regions with moderate totals.
								<span class="image featured"><img src="images/covid_region.png" alt="" /></span>
								<span class="image featured"><img src="images/covid_state.png" alt="" /></span>
								</p>
								<!-- Between August 2020 and April 2024, the Southern and Midwestern U.S. regions together accounted for approximately 61% of all reported COVID-19 hospitalizations nationwide. The South alone contributed 41%, with Texas (22%) and Florida (21%) being the primary drivers — together making up over 43% of the South’s total cases. Midwest region followed closely, driven largely by Illinois and Ohio, which together made up more than a third of the region’s hospitalization volume. Both states experienced repeated surges, particularly during the winter waves of 2020 and 2021. -->
								


								<p><h4 style="margin-bottom: 0.5em;">Measuring the Strain: COVID Bed Usage Across States</h4>
								<!-- Beyond the Count: COVID’s True Impact on Hospital Capacity -->
								To better understand how severely hospitals were strained by COVID-19, I first calculated each hospital’s COVID usage and inpatient capacity based on weekly report. I then rolled those values up by state and year to estimate how much of each state’s hospital capacity was used for COVID care in a given year. The final metric is the percentage of available inpatient beds that were on average occupied by COVID-related cases, joining the result with a U.S. Census region mapping table to allow geographic comparisons at state-level yearly totals.

								<!-- To ensure accuracy and avoid bias from inconsistent hospital reporting,  -->

								To better understand how severely hospitals were strained by COVID-19, I analyzed the percentage of inpatient capacity that was occupied by COVID patients. 

								<pre><code class="language-sql">
			WITH yearly AS (
					SELECT
				    	hospital_pk,
				    	state,
				    	YEAR(STR_TO_DATE(r.collection_week, '%Y-%m-%d')) AS year,
				    	AVG(NULLIF(inpat_beds_used_covid_7daysum, 0)) AS AvgCovidBedsUsedPerHospital,
				    	AVG(NULLIF(inpat_beds_7daysum, 0)) AS AvgInpatBedsPerHospital
				  FROM tmp_raw_data_3 AS r
				  GROUP BY hospital_pk, state, year)

			SELECT
				state,
				region,
				year,
			    SUM(AvgCovidBedsUsedPerHospital) AS TotalCovidBedsUsed_StateYear,
			    SUM(AvgInpatBedsPerHospital) AS TotalInpatBeds_StateYear,
			    ROUND(SUM(AvgCovidBedsUsedPerHospital) / NULLIF(SUM(AvgInpatBedsPerHospital), 0), 4) AS CovidBed_Utilization
			FROM yearly y
				INNER JOIN (SELECT region, statecode FROM region_mapping) AS m ON y.state = m.statecode
				GROUP BY 1, 2, 3
				ORDER BY 1, 3;
								</code></pre>

								This metric offers a clearer lens on how states were to being overwhelmed at different stages of the pandemic. COVID bed utilization steadily declined nationwide from 2020 to 2024, reflecting a broader relief in hospital system pressure over time. In 2023, Maryland reported the highest utilization rate at 7.39%, followed closely by North Carolina and Delaware. Notably, Southern and Northeastern states dominated the top utilization rankings, highlighting a pattern of more intense regional strain during this phase of pandemic.
								
								<span class="image featured"><img src="images/covid_dash1.png" alt="" /></span>
								</p>



								<p><h4 style="margin-bottom: 0.5em;">Unequal Burdens: Population-Normalized Hospitalization Patterns</h4>
								To enable fair cross-state comparisons, I adjusted total hospitalization counts by population using U.S. Census estimates from 2020 to 2023. This helped highlight states where hospitalizations were disproportionately high relative to the number of residents. Additionally, I calculated the number of hospitals per 100,000 people to understand access and availability across states. These metrics revealed key imbalances between hospital resources and patient needs.

								<pre><code class="language-sql">
			-- Total confirmed COVID hospitalizations per state, year 
			SELECT
			    cp.state,
			    cp.year,
			    cp.total_combined_patients,
			    pd.total_population,
			    ROUND((cp.total_combined_patients / NULLIF(pd.total_population, 0)) * 100, 4)  AS Percentage
			FROM  ( SELECT state,
			      		   YEAR(STR_TO_DATE(collection_week, '%Y-%m-%d')) 					   AS year,
			      		   SUM(CASE WHEN tot_adult_patients_hosp_confrm_covid_7daysum = -999999 THEN 0 
			      		   			ELSE tot_adult_patients_hosp_confrm_covid_7daysum END +
			        		   CASE WHEN tot_ped_patients_hosp_confrm_covid_7daysum = -999999 THEN 0 
			        		   		ELSE tot_ped_patients_hosp_confrm_covid_7daysum END) 	   AS total_combined_patients
			    	FROM tmp_raw_data_3
			    	WHERE YEAR(STR_TO_DATE(collection_week, '%Y-%m-%d')) BETWEEN 2020 AND 2023
			    	GROUP BY state, year) 													   AS cp
			JOIN  ( SELECT state, popestimate2020 AS total_population, '2020' AS year FROM population  UNION ALL 
					SELECT state, popestimate2021 AS total_population, '2021' AS year FROM population  UNION ALL 
					SELECT state, popestimate2022 AS total_population, '2022' AS year FROM population  UNION ALL 
					SELECT state, popestimate2023 AS total_population, '2023' AS year FROM population  ) AS pd 
			  	ON cp.state = pd.state AND cp.year = pd.year
			ORDER BY cp.state, cp.year;
								</code></pre>

								<pre><code class="language-sql">
			-- Number of hospitals per 100,000 residents by state and year
			SELECT h.state,
			       h.total_hospitals,
			       p.population,
			       p.year,
			       ( h.total_hospitals / Nullif(p.population, 0) ) * 100000 AS hospitals_per_100k_people
			FROM  ( SELECT state,
			               Count(DISTINCT hospital_pk) 						AS total_hospitals
			        FROM   tmp_raw_data_3
			        GROUP  BY state ) AS h
			        JOIN ( SELECT state, popestimate2020 AS total_population, '2020' AS year FROM population  UNION ALL
			               SELECT state, popestimate2021 AS total_population, '2021' AS year FROM population  UNION ALL
			               SELECT state, popestimate2022 AS total_population, '2022' AS year FROM population  UNION ALL
			               SELECT state, popestimate2023 AS total_population, '2023' AS year FROM population  ) AS p
			            ON h.state = p.state; 
         						</code></pre>

								COVID-related hospital strain peaked in 2021, particularly in the South and parts of the West, where hospitalization rates per population were even higher than in 2020. Interestingly, states with more hospitals per capita such as North and South Dakota experienced lower patient loads, while Southern states with fewer hospitals faced much heavier pressure. Urban-heavy states like Texas and Florida also saw greater strain compared to more rural regions, reflecting an uneven distribution of hospital resources and patient demand across the country.

								<span class="image featured"><img src="images/covid_pop.png" alt="" /></span>
								</p>


								<p><h4 style="margin-bottom: 0.5em;">Learning Highlights</h4>
								Working through this project gave me more than just SQL practice — it challenged me to think end-to-end, from raw data to real-world impact:
								<ul style="margin-bottom: 0;">
								<li>Cleaned and prepared over 960,000 hospital records with missing values, irregular formats, and outliers

								<li>Enriched raw data with region mappings and population estimates to support contextual, population-adjusted insights

								<li>Wrote structured SQL queries using nested subqueries, JOINs, CASE WHEN logic, and CTEs to uncover meaningful patterns

								<li>Normalized date fields using STR_TO_DATE() to enable consistent time-series analysis
								
								<li>Thought critically about how hospital capacity, demand surges, and regional geography influenced operational outcomes
								</li></ul>
								More than anything, this project deepened my confidence in working with messy, real-world datasets and strengthened my ability to turn ambiguity into clarity through structured analysis and thoughtful storytelling.
								</p>


								<footer>
									<ul class="stats">
										<li><a href="index.html#covid">Back to Projects</a></li>
										<!-- <li><a href="#" class="icon solid fa-heart">28</a></li>
										<li><a href="#" class="icon solid fa-comment">128</a></li> -->
									</ul>
								</footer>
							</article>

					</div>

				<!-- Footer -->
					<!-- <section id="footer">
						<ul class="icons">
							<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
							<li><a href="#" class="icon solid fa-rss"><span class="label">RSS</span></a></li>
							<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
						</ul>
						<p class="copyright">&copy; Untitled. Design: <a href="http://html5up.net">HTML5 UP</a>. Images: <a href="http://unsplash.com">Unsplash</a>.</p>
					</section> -->

			</div>

		<!-- Scripts -->
			<script src="future-assets/js/jquery.min.js"></script>
			<script src="future-assets/js/browser.min.js"></script>
			<script src="future-assets/js/breakpoints.min.js"></script>
			<script src="future-assets/js/util.js"></script>
			<script src="future-assets/js/main.js"></script>

	</body>
</html>